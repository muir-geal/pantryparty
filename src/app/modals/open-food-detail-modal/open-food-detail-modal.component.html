<ion-header>
  <ion-toolbar>
    <ion-title>{{ food?.name || "food details" }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="dismiss()">
        <ion-icon name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content
  class="ion-padding"
  style="height: 100%; overflow: auto; font-size: 1.1em"
>
  <div *ngIf="food">
    <p>{{ food.package_size }} {{ food.package_unit }}</p>
    <p *ngIf="food.available > 0">
      {{ food.available }} {{ food.package_unit }} available for sharing
    </p>
    <p *ngIf="!food.available || food.available == 0">
      not available for sharing
    </p>
    <div *ngIf="food.nutriments" style="border-top: 1px solid #ccc">
      <!--<p *ngIf="food.nutriments?.['energy-kcal'] && food.package_unit != 'pcs'">
        {{
          (food.nutriments["energy-kcal"] * food.package_size) / 100
            | number : "1.0-0"
        }}
        calories left
      </p>
      <p *ngIf="food.nutriments?.['energy-kcal']">
        {{ food.nutriments["energy-kcal"] }}
        calories / 100g
      </p>
      <p *ngIf="food.nutriments?.['energy-kcal_serving']">
        {{ food.nutriments["energy-kcal_serving"] }} calories per serving
      </p>-->

      <div *ngIf="getCalorieInfo(food) as calorieInfo">
        <p>{{ calorieInfo.total }} calories total</p>
        <p>{{ calorieInfo.per100g }} cal/100g</p>
        <p *ngIf="calorieInfo.perServing !== calorieInfo.per100g">
          {{ calorieInfo.perServing }} cal/serving
        </p>
      </div>

      <div *ngIf="food.nutriments && food.package_unit != 'pcs'">
        <p *ngIf="food.nutriments?.proteins">
          {{
            (food.nutriments.proteins * (food.package_size || food.amount)) /
              100 | number : "1.0-0"
          }}g protein
        </p>
        <p *ngIf="food.nutriments?.fat">
          {{
            (food.nutriments.fat * (food.package_size || food.amount)) / 100
              | number : "1.0-0"
          }}g fat
        </p>
        <p *ngIf="food.nutriments?.sugars">
          {{
            (food.nutriments.sugars * (food.package_size || food.amount)) / 100
              | number : "1.0-0"
          }}g sugar
        </p>
        <p *ngIf="food.nutriments?.salt">
          {{
            (food.nutriments.salt * (food.package_size || food.amount)) / 100
              | number : "1.0-0"
          }}g salt
        </p>
        <p *ngIf="food.nutriments?.carbohydrates">
          {{
            (food.nutriments.carbohydrates *
              (food.package_size || food.amount)) /
              100 | number : "1.0-0"
          }}g carbohydrates
        </p>
      </div>

      <div *ngIf="food.nutriments && food.package_unit == 'pcs'">
        <p *ngIf="food.nutriments?.proteins">
          {{ food.nutriments.proteins }} protein/100g
        </p>
        <p *ngIf="food.nutriments?.fat">{{ food.nutriments.fat }} fat/100g</p>
        <p *ngIf="food.nutriments?.sugars">
          {{ food.nutriments.sugars }} sugar/100g
        </p>
        <p *ngIf="food.nutriments?.salt">
          {{ food.nutriments.salt * food.package_size }} salt/100g
        </p>
        <p *ngIf="food.nutriments?.carbohydrates">
          {{ food.nutriments.carbohydrates * food.package_size }}
          carbohydrates/100g
        </p>
      </div>
    </div>

    <!--<div *ngIf="getNutrientList(food).length > 0" class="nutrient-legend">
      <div
        class="legend-item"
        *ngFor="let nutrient of getNutrientList(food)"
        [class.calorie-item]="nutrient.isCalorie"
      >
        <span class="legend-name">{{ nutrient.name }}</span>
        <span class="legend-value">
          {{ nutrient.value | number : "1.0-0" }}{{ nutrient.unit }}
        </span>
      </div>
    </div>-->

    <div
      *ngIf="countAllergens(food) >= 0"
      style="
        border-top: 1px solid #ccc;
        padding-top: 16px;
        padding-bottom: 16px;
      "
    >
      <div *ngIf="countAllergens(food) > 0" class="allergen-warning">
        <strong
          ><ion-icon
            name="warning"
            color="warning"
            style="font-size: 1.2em; vertical-align: text-bottom"
          ></ion-icon>
          allergens ({{ countAllergens(food) }}):</strong
        >
        {{ getAllergenString(food) }}
      </div>
      <div *ngIf="countAllergens(food) === 0" class="allergen-safe">
        <strong>no known allergens</strong>
      </div>
    </div>
    <div
      *ngIf="food.vegan || food.vegetarian || food.halal || food.kosher"
      style="border-top: 1px solid #ccc"
    >
      <p *ngIf="food.vegan">vegan: yes</p>
      <p *ngIf="food.vegetarian && !food.vegan">vegetarian: yes</p>
      <p *ngIf="food.halal">halal: yes</p>
      <p *ngIf="food.kosher">kosher: yes</p>
    </div>
    <div
      *ngIf="food.notes || food.rating"
      style="border-top: 1px solid #ccc; padding-top: 16px"
    >
      <p *ngIf="food.notes" style="margin-top: 0">"{{ food.notes }}"</p>
      <div class="star">
        <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
          <ion-icon [name]="star <= food.rating ? 'star' : 'star-outline'">
          </ion-icon>
        </ng-container>
      </div>
    </div>
    <p
      *ngIf="food.expirationdate"
      style="border-top: 1px solid #ccc; padding-top: 16px"
    >
      expires on: {{ food.expirationdate }}
    </p>
    <div *ngIf="food.available > 0">
      <div *ngIf="!isReserved">
        <ion-button
          style="padding-top: 16px"
          expand="block"
          shape="round"
          color="success"
          (click)="reserveFood()"
          >reserve food</ion-button
        >
      </div>
      <div *ngIf="isReserved">
        <ion-button
          style="padding-top: 16px"
          expand="block"
          shape="round"
          color="danger"
          (click)="reserveFood()"
          >cancel reservation</ion-button
        >
      </div>
    </div>
  </div>
</ion-content>
